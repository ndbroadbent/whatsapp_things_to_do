# Lefthook git hooks configuration
# https://github.com/evilmartians/lefthook

pre-commit:
  parallel: true
  commands:
    biome-format:
      glob: "*.{ts,js,json}"
      run: bunx biome format --write {staged_files}
      stage_fixed: true

    biome-lint:
      glob: "*.{ts,js}"
      run: bunx biome check --write {staged_files}
      stage_fixed: true

    typecheck:
      glob: "*.ts"
      run: bun run typecheck

    duplication:
      glob: "*.ts"
      run: bunx jscpd src/

    knip:
      glob: "*.ts"
      run: bunx knip

    file-length:
      run: ./scripts/check_file_length.sh {staged_files}

    biome-ignores:
      glob: "*.ts"
      run: |
        if grep -l "biome-ignore" {staged_files} 2>/dev/null; then
          echo "‚ùå Found biome-ignore comments in staged files - these are forbidden!"
          exit 1
        fi

    query-embeddings:
      glob: "src/embeddings/queries/*.json"
      run: bun scripts/check-query-embeddings.ts

# Enable pre-push hook so lefthook runs git-lfs pre-push automatically
pre-push:
  commands:
    placeholder:
      run: "true"
